<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArbLex | SC Arbitration Portal</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX parsing -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; margin: 0; padding: 0; }
        .prose pre { white-space: pre-wrap; word-break: break-word; }
        /* Smooth transitions for font size changes */
        .font-size-transition { transition: font-size 0.2s ease-in-out; }
        /* Custom scrollbar for better look on wide screens */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-transparent text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const Icon = ({ name, className = "w-5 h-5" }) => {
            useEffect(() => {
                if (window.lucide) lucide.createIcons();
            }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        const CaseCard = ({ caseData, onCopy, isCopied, fontSize }) => {
            const [isExpanded, setIsExpanded] = useState(false);

            const formatContent = (content) => {
                if (!content) return null;
                return content.split('\n').map((line, i) => {
                    const hyphenMatch = line.match(/^((?:Section|S\.)[^-]+)(?=-)/i);
                    
                    if (hyphenMatch) {
                        const boldPart = hyphenMatch[1];
                        const restOfLine = line.substring(boldPart.length);
                        return (
                            <div key={i} className="mb-1 text-slate-700">
                                <strong className="text-slate-900 font-bold">{boldPart}</strong>{restOfLine}
                            </div>
                        );
                    }

                    const sectionMatch = line.match(/^((?:Section|S\.)\s*\d+[A-Z]?)/i);
                    if (sectionMatch) {
                        const sectionPart = sectionMatch[0];
                        const restOfLine = line.substring(sectionPart.length);
                        return (
                            <div key={i} className="mb-1 text-slate-700">
                                <strong className="text-slate-900 font-bold">{sectionPart}</strong>{restOfLine}
                            </div>
                        );
                    }
                    return <div key={i} className="mb-1 text-slate-700">{line}</div>;
                });
            };

            return (
                <div className="bg-white border border-slate-200 rounded-xl md:rounded-2xl p-4 md:p-6 hover:border-indigo-300 hover:shadow-md transition-all group mb-4">
                    <div className="flex justify-between items-start gap-3 mb-3">
                        <div className="cursor-pointer flex-1" onClick={() => setIsExpanded(!isExpanded)}>
                            <h3 className="text-lg md:text-xl font-bold text-slate-800 leading-snug group-hover:text-indigo-700 transition-colors">
                                {caseData.title}
                            </h3>
                            {caseData.citation && (
                                <p className="text-slate-500 font-medium text-xs md:text-sm mt-1">
                                    {caseData.citation}
                                </p>
                            )}
                        </div>
                        <div className="flex gap-1 md:gap-2">
                            <button 
                                onClick={() => onCopy(`${caseData.title} ${caseData.citation}`, caseData.id)}
                                className={`flex-shrink-0 p-2 rounded-lg transition-colors ${isCopied ? 'bg-green-50 text-green-600' : 'bg-slate-50 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50'}`}
                                title="Copy Case Info"
                            >
                                {isCopied ? <Icon name="check" className="w-4 h-4" /> : <Icon name="copy" className="w-4 h-4" />}
                            </button>
                        </div>
                    </div>

                    <div className="flex flex-wrap gap-1.5 mb-4">
                        <span className="px-2 py-0.5 md:py-1 bg-indigo-50 text-indigo-600 rounded-md text-[10px] md:text-xs font-semibold flex items-center gap-1">
                            <Icon name="filter" className="w-3 h-3" /> SC Judgment
                        </span>
                        {caseData.date && (
                             <span className="px-2 py-0.5 md:py-1 bg-slate-100 text-slate-500 rounded-md text-[10px] md:text-xs font-medium border border-slate-200 uppercase tracking-wider">
                                {caseData.date}
                            </span>
                        )}
                    </div>

                    <div 
                        className={`text-slate-600 font-size-transition leading-relaxed overflow-hidden transition-all ${isExpanded ? 'max-h-[3000px]' : 'max-h-24 md:max-h-28'}`}
                        style={{ fontSize: `${fontSize}px` }}
                    >
                        <div className="whitespace-pre-wrap">
                            {formatContent(caseData.content)}
                        </div>
                    </div>

                    <div className="mt-4 flex items-center justify-between border-t border-slate-50 pt-4">
                        <button 
                            onClick={() => setIsExpanded(!isExpanded)}
                            className="text-indigo-600 text-xs md:text-sm font-semibold hover:text-indigo-800 flex items-center gap-1"
                        >
                            {isExpanded ? 'Show Less' : 'Read Full Summary'} 
                            <Icon name="arrow-up-right" className={`w-3 h-3 transition-transform ${isExpanded ? 'rotate-180' : ''}`} />
                        </button>

                        {caseData.url && (
                            <a 
                                href={caseData.url} 
                                target="_blank" 
                                rel="noopener noreferrer"
                                className="inline-flex items-center gap-2 px-3 md:px-4 py-1.5 md:py-2 bg-indigo-600 text-white rounded-lg md:rounded-xl text-[10px] md:text-xs font-bold hover:bg-indigo-700 transition-colors shadow-sm"
                            >
                                <span className="hidden xs:inline">Read Judgment</span>
                                <span className="xs:hidden">Link</span>
                                <Icon name="external-link" className="w-3.5 h-3.5" />
                            </a>
                        )}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [cases, setCases] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchQuery, setSearchQuery] = useState('');
            const [copiedId, setCopiedId] = useState(null);
            const [fontSize, setFontSize] = useState(14);

            const DATA_URL = 'https://raw.githubusercontent.com/citecase/arb/refs/heads/main/arb.md';

            useEffect(() => {
                fetchData();
            }, []);

            const fetchData = async () => {
                try {
                    const response = await fetch(DATA_URL);
                    const text = await response.text();
                    setCases(parseMarkdown(text));
                    setLoading(false);
                } catch (err) {
                    console.error("Error fetching data:", err);
                    setLoading(false);
                }
            };

            const parseMarkdown = (text) => {
                const blocks = text.split(/\n---\n|\n(?=### )/);
                return blocks.map((block, index) => {
                    const lines = block.trim().split('\n');
                    const titleLine = lines.find(l => l.startsWith('### ')) || '';
                    
                    let rawTitle = titleLine.replace('### ', '').trim();
                    let cleanedTitle = rawTitle
                        .replace(/[\[\]\\]/g, '') 
                        .replace(/\(https?:\/\/[^\)]+\)/g, '') 
                        .trim();

                    const urlMatch = block.match(/https?:\/\/[^\s\)\>\]]+/);
                    const url = urlMatch ? urlMatch[0] : null;

                    const citationMatch = cleanedTitle.match(/\d{4}\s+INSC\s+\d+/i) || cleanedTitle.match(/\[\d{4}\].*?SC.*?\d+/i);
                    let citation = citationMatch ? citationMatch[0] : '';
                    
                    if (citation) {
                        cleanedTitle = cleanedTitle.split(citation)[0].replace(/[;\-\s]+$/, '').trim();
                    }

                    cleanedTitle = cleanedTitle.replace(/[\-\\]+$/, '').trim();

                    const dateMatch = block.match(/(\d{1,2}\s+\w+\s+\d{4})|(\d{4}-\d{2}-\d{2})/);
                    
                    const rawContent = block.replace(titleLine, '').trim();
                    const cleanContent = rawContent
                        .replace(/Arbitration and Conciliation Act,?\s*1996/gi, '') 
                        .replace(/\\-/g, '-') 
                        .replace(/\\/g, '')   
                        .replace(/\(https?:\/\/[^\)]+\)/g, '') 
                        .split('\n')
                        .map(line => line.trim())
                        .map(line => line.replace(/^[\s\-\:\;]+/, ''))
                        .filter(line => line.length > 0 && !line.startsWith('###'))
                        .join('\n');

                    return {
                        id: index,
                        title: cleanedTitle || 'Untitled Case',
                        citation,
                        url,
                        date: dateMatch ? dateMatch[0] : null,
                        content: cleanContent
                    };
                }).filter(c => c.title !== 'Untitled Case');
            };

            const filteredCases = useMemo(() => {
                const q = searchQuery.toLowerCase();
                return cases.filter(c => 
                    c.title.toLowerCase().includes(q) || 
                    c.citation.toLowerCase().includes(q) || 
                    c.content.toLowerCase().includes(q)
                );
            }, [searchQuery, cases]);

            const copyCitation = (text, id) => {
                navigator.clipboard.writeText(text).then(() => {
                    setCopiedId(id);
                    setTimeout(() => setCopiedId(null), 2000);
                });
            };

            const adjustFontSize = (delta) => {
                setFontSize(prev => Math.min(Math.max(prev + delta, 12), 24));
            };

            if (loading) return (
                <div className="flex flex-col items-center justify-center py-20 bg-transparent">
                    <div className="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-700 mb-4"></div>
                    <p className="text-slate-500 text-sm font-medium tracking-tight">Accessing Records...</p>
                </div>
            );

            return (
                <div className="w-full bg-transparent px-2 md:px-0">
                    <div className="max-w-6xl mx-auto py-4 md:py-6">
                        <div className="space-y-6">
                            <div className="flex flex-col md:flex-row gap-3 items-center sticky top-0 bg-slate-50/90 backdrop-blur-md z-10 py-3 md:py-4 -mx-2 px-2 md:mx-0 md:px-0">
                                <div className="relative group flex-1 w-full">
                                    <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-indigo-600 transition-colors">
                                        <Icon name="search" className="w-4 h-4 md:w-5 md:h-5" />
                                    </div>
                                    <input 
                                        type="text" 
                                        placeholder="Search cases, citations, sections..." 
                                        className="w-full pl-11 md:pl-12 pr-4 py-3 md:py-4 bg-white border border-slate-200 rounded-xl md:rounded-2xl focus:border-indigo-500 outline-none transition-all shadow-sm text-sm md:text-base"
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                    />
                                </div>
                                <div className="flex items-center gap-1 bg-white border border-slate-200 p-1 md:p-1.5 rounded-xl shadow-sm self-end md:self-auto">
                                    <button 
                                        onClick={() => adjustFontSize(-1)}
                                        className="p-2 hover:bg-slate-50 rounded-lg text-slate-500 transition-colors"
                                        title="Decrease font size"
                                    >
                                        <Icon name="minus" className="w-3.5 h-3.5" />
                                    </button>
                                    <div className="px-1 text-[10px] font-bold text-slate-400 uppercase tracking-widest w-8 text-center">
                                        Size
                                    </div>
                                    <button 
                                        onClick={() => adjustFontSize(1)}
                                        className="p-2 hover:bg-slate-50 rounded-lg text-slate-500 transition-colors"
                                        title="Increase font size"
                                    >
                                        <Icon name="plus" className="w-3.5 h-3.5" />
                                    </button>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 gap-1">
                                {filteredCases.length > 0 ? (
                                    filteredCases.map(c => (
                                        <CaseCard 
                                            key={c.id} 
                                            caseData={c} 
                                            onCopy={copyCitation} 
                                            isCopied={copiedId === c.id} 
                                            fontSize={fontSize}
                                        />
                                    ))
                                ) : (
                                    <div className="text-center py-16 bg-white rounded-2xl border border-dashed border-slate-200">
                                        <Icon name="book-open" className="w-10 h-10 text-slate-200 mx-auto mb-3" />
                                        <p className="text-slate-400 text-sm font-medium px-4">
                                            {searchQuery ? `No matches found for "${searchQuery}"` : "The database is being updated."}
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
